import{_ as e,u as a,z as t,a as l,c as s,d as o,e as r,b as n,i,r as c,f as u,g as d,t as m,l as p,w as f,h as b,j as _,k as v,E as w,o as h,m as g,n as y,F as q,A as T,B as k,C as x,D as P,p as F,q as R,G as C}from"./index-9e27afd7.js";import{F as N}from"./FullLoading-248942d7.js";import{V}from"./ValidateText-c3a47b08.js";import{S as j,r as S,u as U}from"./xlsx-1ee80fa6.js";import{F as W}from"./file-7b881300.js";import{U as A}from"./UploadFiles-8f77d823.js";import"./search-ad5cf249.js";import"./loading-f40b77db.js";const I={class:"flex"},B=e({__name:"ReqrName",setup(e){const c=a(),u=t((()=>c.application.coreTeam.reqr.name));return(e,a)=>{const t=l("el-input");return s(),o("span",I,[r(t,{modelValue:n(u),"onUpdate:modelValue":a[0]||(a[0]=e=>i(u)?u.value=e:null),disabled:""},null,8,["modelValue"])])}}},[["__file","C:/Program Files/Workspace/it-req-fe/src/views/edit-new/components/coreTeam/components/ReqrName.vue"]]),E={class:"flex"},z=e({__name:"PgrName",setup(e){const d=t((()=>a().application.coreTeam.pgr.name)),m=c({}),p=e=>{m.value=e,d.value=e.name,a().setPgr(m.value)};return(e,a)=>{const t=l("el-input");return s(),o("span",E,[u(" 顯示 Programmer name 框 "),r(t,{modelValue:n(d),"onUpdate:modelValue":a[0]||(a[0]=e=>i(d)?d.value=e:null),disabled:""},null,8,["modelValue"]),u(" 選擇 Programmer button 與搜尋對話框 "),r(n(j),{dept:"IT",onGetUserInfo:p})])}}},[["__scopeId","data-v-79b2d2e2"],["__file","C:/Program Files/Workspace/it-req-fe/src/views/edit-new/components/coreTeam/components/PgrName.vue"]]),G={class:"ce-title-lg"},D={class:"mt-3 mb-8"},L=e({__name:"index",setup:e=>(e,a)=>{const t=l("el-col"),i=l("el-row"),c=l("el-form-item");return s(),o("div",null,[d("span",G,m(n(p)("Define core team member")),1),d("div",D,[u(" Requester name "),r(c,{label:n(p)("Requester name")},{default:f((()=>[r(i,{class:"form-row-width"},{default:f((()=>[r(t,{span:12},{default:f((()=>[r(B)])),_:1})])),_:1})])),_:1},8,["label"]),u(" IT name "),r(c,{label:n(p)("IT name")},{default:f((()=>[r(i,{class:"form-row-width"},{default:f((()=>[r(t,{span:12},{default:f((()=>[r(z)])),_:1}),r(t,{span:12},{default:f((()=>[r(n(V),{"key-outer":"coreTeam","key-inner":"pgr"})])),_:1})])),_:1})])),_:1},8,["label"])])])}},[["__file","C:/Program Files/Workspace/it-req-fe/src/views/edit-new/components/coreTeam/index.vue"]]),M={href:"/application/template.xlsx",class:"ce-link",download:"it-req-template"},O=d("br",null,null,-1),H=e({__name:"Notice",setup:e=>(e,a)=>{const t=l("el-alert");return s(),b(t,{type:"info",title:n(p)("How to fill out this form?"),"show-icon":"",closable:!1},{default:f((()=>[_(m(n(p)("You can download"))+" ",1),d("a",M,m(n(p)("template file")),1),_(" "+m(n(p)(", then upload it after you complete it")),1),O,_(" "+m(n(p)("Without uploading the template, you can complete these fields then submit it")),1)])),_:1},8,["title"])}},[["__file","C:/Program Files/Workspace/it-req-fe/src/views/edit-new/components/reqTable/components/Notice.vue"]]),Y=e({__name:"PrintReqTable",emits:["get-need-refresh"],setup(e,{emit:t}){const o=c(null),i=a(),u=t,d=e=>{o.value.clearFiles(),e.raw=null,i.setReqTable({reqName:"",stage:"",customer:"",device:"",tester:"",equipment:"",system:"",purpose:""}),u("get-need-refresh",!0)},h=(e,a)=>{o.value.clearFiles();const t=e[0];t.uid=v(),o.value.handleStart(t)},g=e=>{if(!e.raw)return;let a=e.raw,t=new FileReader;t.onloadend=a=>{let l=t.result,s=S(l,{type:"array"}),o=s.SheetNames,r=s.Sheets[o];U.sheet_to_json(r);for(let t=2;t<=9;t++)if(void 0===r[U.encode_cell({r:t,c:3})])return w.error(p("You have not completed the request table yet")),void d(e);i.setReqTable({reqName:r[U.encode_cell({r:2,c:3})].v,stage:r[U.encode_cell({r:3,c:3})].v,customer:r[U.encode_cell({r:4,c:3})].v,device:r[U.encode_cell({r:5,c:3})].v,tester:r[U.encode_cell({r:6,c:3})].v,equipment:r[U.encode_cell({r:7,c:3})].v,system:r[U.encode_cell({r:8,c:3})].v,purpose:r[U.encode_cell({r:9,c:3})].v}),u("get-need-refresh",!0)},t.readAsArrayBuffer(a)};return(e,a)=>{const t=l("el-button"),i=l("el-upload"),c=l("el-form-item");return s(),b(c,{label:n(p)("Upload excel"),class:"block"},{default:f((()=>[r(i,{ref_key:"uploadRef",ref:o,limit:1,"on-remove":d,"auto-upload":!1,"on-exceed":h,"on-change":g,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"},{trigger:f((()=>[r(t,{type:"primary",plain:""},{default:f((()=>[_(m(`${n(p)("Select file")}...`),1)])),_:1})])),_:1},512)])),_:1},8,["label"])}}},[["__scopeId","data-v-7c6db4b2"],["__file","C:/Program Files/Workspace/it-req-fe/src/views/edit-new/components/reqTable/components/PrintReqTable.vue"]]),$=e({__name:"ManualReqTable",props:{refreshCode:{type:Number,default:0}},setup(e){const t=a(),i=c({}),u=e,d={reqName:{label:"Request name",type:"textarea",rows:"1"},stage:{label:"Stage"},customer:{label:"Customer"},device:{label:"Device"},tester:{label:"Tester"},equipment:{label:"Equipment"},system:{label:"System"},purpose:{label:"Purpose",type:"textarea",rows:"5"}},m=e=>t.setReqTable(i.value);return h((()=>i.value=t.getReqTable)),g(u,(e=>i.value=t.getReqTable)),(e,a)=>{const t=l("el-input"),c=l("el-col"),u=l("el-row"),b=l("el-form-item");return s(),o(q,null,y(d,((e,a)=>r(b,{key:a,label:n(p)(e.label)},{default:f((()=>[r(u,{class:"form-row-width"},{default:f((()=>[r(c,{span:12},{default:f((()=>[r(t,{modelValue:n(i)[a],"onUpdate:modelValue":e=>n(i)[a]=e,type:e.type,rows:e.rows,onChange:m},null,8,["modelValue","onUpdate:modelValue","type","rows"])])),_:2},1024),r(c,{span:12},{default:f((()=>[r(n(V),{"key-outer":"reqTable","key-inner":a},null,8,["key-inner"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["label"]))),64)}}},[["__file","C:/Program Files/Workspace/it-req-fe/src/views/edit-new/components/reqTable/components/ManualReqTable.vue"]]),K=e({__name:"PlantRadios",setup(e){const t=a(),o=c("");return h((()=>o.value=t.getPlant)),g(o,(e=>t.setPlant(o.value))),(e,a)=>{const t=l("el-radio"),c=l("el-radio-group"),u=l("el-col"),d=l("el-row"),m=l("el-form-item");return s(),b(m,{label:n(p)("Plant")},{default:f((()=>[r(d,{class:"form-row-width"},{default:f((()=>[r(u,{span:12},{default:f((()=>[r(c,{modelValue:n(o),"onUpdate:modelValue":a[0]||(a[0]=e=>i(o)?o.value=e:null)},{default:f((()=>[r(t,{label:"P1",size:"small",class:"pl-2"},{default:f((()=>[_("P1")])),_:1}),r(t,{label:"P2",size:"small"},{default:f((()=>[_("P2")])),_:1}),r(t,{label:"P3",size:"small"},{default:f((()=>[_("P3")])),_:1})])),_:1},8,["modelValue"])])),_:1}),r(u,{span:12},{default:f((()=>[r(n(V),{"key-outer":"reqTable","key-inner":"plant"})])),_:1})])),_:1})])),_:1},8,["label"])}}},[["__file","C:/Program Files/Workspace/it-req-fe/src/views/edit-new/components/reqTable/components/PlantRadios.vue"]]),J={class:"ce-title-lg"},Q={class:"p-3"},X={class:"mt-3 mb-8"},Z={style:{width:"100%",margin:"8px"}},ee={style:{"margin-bottom":"8px"}},ae=(e=>(x("data-v-19d82b58"),e=e(),P(),e))((()=>d("br",null,null,-1))),te={key:0,class:"ce-gray-color-italic attachedFiles-container"},le=["href","download"],se={class:"inline-flex"},oe=e({__name:"index",setup(e){const t=a(),i=c(0),v=T().params.reqNo,g=c([]),x=e=>{e&&i.value++},P=async e=>{t.setAttachedFiles(e)},F=c(!1),R=()=>{k.confirm(p("Are you sure to upload attached file again?"),"Warning",{confirmButtonText:p("OK"),cancelButtonText:p("Cancel"),type:"warning",dangerouslyUseHTMLString:!0}).then((()=>F.value=!0)).catch((()=>w.info(p("Action cancelled"))))};return h((()=>{g.value=t.getAttachedFiles,t.setAttachedFiles(g.value)})),(e,a)=>{const t=l("el-button"),c=l("el-form-item");return s(),o("div",null,[d("span",J,m(n(p)("Fill the request table")),1),u(" 提示 alert "),d("div",Q,[r(n(H))]),u(" 填 Request table 可以有兩種方式:  "),d("div",X,[u(" 1. 讀 .xlsx 檔填表 "),r(n(Y),{onGetNeedRefresh:x}),u(" 2. 手動輸入各項欄位 "),r(n($),{"refresh-code":n(i)},null,8,["refresh-code"]),u(" 再來選擇此需求是哪個廠 "),r(n(K)),u(" 上傳附件 "),r(c,{label:n(p)("Attached files")},{default:f((()=>[d("span",Z,[d("span",ee,m(n(p)("Uploaded files")),1),ae,n(g).length?u("v-if",!0):(s(),o("div",te,m(n(p)("There is no file attached")),1)),(s(!0),o(q,null,y(n(g),((e,a)=>(s(),o("div",{key:a,class:"attachedFiles-container"},[d("a",{class:"ce-link",href:"https://35.229.168.239:7000//uploads/attached_files/"+e.fileName,download:n(v)+"_attachment_"+e.originalName,target:"_blank"},[d("div",se,[r(n(W),{class:"mr-1"}),_(" "+m(e.originalName),1)])],8,le)])))),128)),n(F)?u("v-if",!0):(s(),b(t,{key:1,disabled:n(F),plain:"",type:"primary",style:{"margin-bottom":"12px"},onClick:R},{default:f((()=>[_(m(n(p)("Upload again")),1)])),_:1},8,["disabled"]))]),n(F)?(s(),b(n(A),{key:0,size:"small",plain:true,onGetChildren:P})):u("v-if",!0)])),_:1},8,["label"])])])}}},[["__scopeId","data-v-19d82b58"],["__file","C:/Program Files/Workspace/it-req-fe/src/views/edit-new/components/reqTable/index.vue"]]),re={class:"edit-new-submit-container"},ne=e({__name:"SubmitButton",setup(e){const t=a(),i=T().params.reqNo,u=F(),d=c(!1),b=async()=>{await t.checkEmpty(!1),await v()},v=async()=>{const e=await t.getValidate;let a=!1;for await(const[l,s]of Object.entries(e))for await(const[e,o]of Object.entries(s)){const l=t.getBenefitType;if(t.getRequestType,a=""===o,""!==o){switch(e){case"pgr":window.scrollTo({top:0,behavior:"smooth"});break;case"reqName":case"stage":case"customer":{const e="Efficiency"===l?510:560;window.scrollTo({top:e,behavior:"smooth"});break}case"device":case"tester":case"equipment":case"system":case"purpose":case"plant":{const e="Efficiency"===l?840:880;window.scrollTo({top:e,behavior:"smooth"});break}}return}}a&&await h()},h=async()=>{d.value=!0;const e=R.service({lock:!0,text:`${p("Loading")}...`,background:"rgba(168, 171, 178, 0.3)"});setTimeout((async()=>{await t.editApplication(i)?(w.success(p("Edit a IT-Request successfully")),u.replace({path:"/tables"})):(w.error(p("Failed to edit a IT-Request")),u.push({path:"/reload"})),e.close(),d.value=!1}),2e3)};return(e,a)=>{const t=l("el-button");return s(),o("div",re,[r(t,{type:"primary",loading:n(d),onClick:b},{default:f((()=>[_(m(n(p)("Submit")),1)])),_:1},8,["loading"])])}}},[["__scopeId","data-v-76d7ca6a"],["__file","C:/Program Files/Workspace/it-req-fe/src/views/edit-new/components/SubmitButton.vue"]]),ie={id:"addnew-container",class:"ce-main-container"},ce={key:0},ue=e({__name:"index",setup(e){const t=F(),i=a(),d=c(!1);return h((async()=>{d.value=!0;const e=await i.fetchApplication(T().params.reqNo),a=C().userId,l=!(!(i.application.coreTeam.reqr.id===a)||!e);d.value=!1,l||t.push({path:"/401",replace:!0})})),(e,a)=>{const t=l("el-form");return s(),o("div",ie,[r(n(N),{loading:n(d)},null,8,["loading"]),n(d)?u("v-if",!0):(s(),o("div",ce,[r(t,{"label-width":"150px"},{default:f((()=>[u(" Core team members "),r(n(L)),u(" Request table "),r(n(oe))])),_:1}),u(" Submit button "),r(n(ne))]))])}}},[["__file","C:/Program Files/Workspace/it-req-fe/src/views/edit-new/index.vue"]]);export{ue as default};
