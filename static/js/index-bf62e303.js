import{_ as e,r as t,m as a,z as l,aa as o,a as s,b as r,c as n,d as i,e as u,w as c,F as d,n as w,f as v,l as f,h as y,g as p,t as g,i as m,U as h,V as b,E as k,o as x,ab as _,j as C}from"./index-4ed6fded.js";import{T as F}from"./TopTitle-0bc76145.js";import{L as T}from"./LoadAll-24fc8694.js";import{E as q,F as A}from"./FileSaver.min-56610965.js";const E={key:0,class:"views-table-container"},R=e({__name:"ViewsTable",props:{data:{type:Array,required:!0},loadAll:{type:Boolean,required:!0},selected:{type:String,required:!0,default:()=>"daily"},loading:{type:Boolean,required:!0,default:()=>!1}},setup(e){const p=e,g=t([]),m=t(null),h=t([[],[]]),b=t([{key:1,field:"number",title:"#",width:"22%",sortable:!0},{key:2,field:"year",title:"Year",width:"20%"},{key:3,field:"date",title:"Date",width:"20%"},{key:4,field:"total",title:"Total views",width:"38%"}]),k=()=>"footer-row-style",x=({$rowIndex:e,$columnIndex:t})=>"footer-cell",_=({$rowIndex:e,$columnIndex:t})=>0===e&&0===t?{rowspan:2,colspan:2}:{rowspan:1,colspan:1},C=(e,t,a)=>{let l=-1!==t.indexOf("."),o=0;if(l){let a=t.split(".")[0],l=t.split(".")[1];e.forEach((e=>o+=e[a][l]))}else e.forEach((e=>o+=e[t]));switch(a){case"sum":return e.length?o:0;case"mean":return e.length?Math.ceil(o/e.length):0}},F=({columns:e,data:t})=>{const a=t.length,l=[`${p.loadAll?f("Total"):f("The latest")} ${a} ${f(a>1?"records":"record")}`,f("Sum"),C(t,"total","sum")],o=[f("Average"),C(t,"total","mean")];return h.value=[l,o],h.value};a(p,(async e=>{switch(g.value=await p.data,p.selected){case"daily":b.value[2]={key:3,field:"date",title:"Date",width:"20%"};break;case"weekly":b.value[2]={key:3,field:"week",title:"Week",width:"20%"};break;case"monthly":b.value[2]={key:3,field:"month",title:"Month",width:"20%"}}}));const T=l((()=>o().language));return a(T,(async e=>m.value.reloadData(g.value))),(e,t)=>{const a=s("vxe-column"),l=s("vxe-table");return r(g)?(n(),i("div",E,[u(l,{ref_key:"tableRef",ref:m,data:r(g),loading:p.loading,border:"",resizable:"",size:"mini",height:"100%","header-align":"center",align:"center","show-overflow":"","show-header-overflow":"","row-config":{isHover:!0},"show-footer":!0,"footer-row-class-name":k,"footer-cell-class-name":x,"footer-method":F,"footer-span-method":_},{default:c((()=>[(n(!0),i(d,null,w(r(b),(e=>(n(),y(a,{key:e.key,field:e.field,title:r(f)(e.title),width:e.width,sortable:e.sortable},null,8,["field","title","width","sortable"])))),128))])),_:1},8,["data","loading"])])):v("v-if",!0)}}},[["__scopeId","data-v-1cdb0ab4"],["__file","C:/Program Files/Workspace/it-req-fe/src/views/page-views/components/ViewsTable.vue"]]),W={class:"mr-2"},j=e({__name:"SelectViews",props:{selected:{type:String,required:!0,default:()=>"daily"}},emits:["get-children"],setup(e,{emit:l}){const o=l,v=e,y=t("daily"),h=[{label:"Daily",value:"daily"},{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"}];return a(v,((e,t)=>y.value=v.selected)),a(y,((e,t)=>o("get-children",y.value))),(e,t)=>{const a=s("el-option"),l=s("el-select");return n(),i("span",null,[p("strong",W,g(r(f)("Switch status"))+":",1),u(l,{modelValue:r(y),"onUpdate:modelValue":t[0]||(t[0]=e=>m(y)?y.value=e:null)},{default:c((()=>[(n(),i(d,null,w(h,(e=>u(a,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])}}},[["__file","C:/Program Files/Workspace/it-req-fe/src/views/page-views/components/SelectViews.vue"]]),O={id:"exportXlsx-container"},D={class:"mr-2"},I=e({__name:"ExportXlsx",props:{daily:{type:Array,require:!0,default:()=>[]},weekly:{type:Array,require:!0,default:()=>[]},monthly:{type:Array,require:!0,default:()=>[]}},setup(e){const l=e,o=h(),d=t(`IT-Request_${o}_page-views-report`),w=t(["Daily","Weekly","Monthly"]),v=t([]),y=t(["#","Year","Date","Total views"]),m=t([]),x=t(["#","Year","Week","Total views"]),_=t([]),C=t(["#","Year","Month","Total views"]),F=async e=>{const t=[];for await(const a of e){const e=[];for await(const[t,l]of Object.entries(a))"_X_ROW_KEY"!==t&&e.push(l);t.push(e)}return t};a(l,(async()=>{const e=await l.daily;v.value=Object.assign([],await F(e));const t=await l.weekly;m.value=Object.assign([],await F(t));const a=await l.monthly;_.value=Object.assign([],await F(a))}));const T=async(e,t,a,l)=>{const o=e.addWorksheet(t),s={bold:!0,size:10,name:"Arial"},r={type:"pattern",pattern:"solid",fgColor:{argb:"FFE4E7ED"}},n={size:10,name:"Arial"},i={bold:!0,size:10,name:"Arial",color:{argb:"FF0000FF"}},u={vertical:"middle",horizontal:"center"},c={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}};for(let d=0;d<l.length+1;d++)d<1?o.addRow(a):o.addRow(l[d-1]);for(let d=1;d<=a.length;d++){o.getColumn(d).width=18,o.getColumn(d).alignment=u;for(let e=1;e<=o.rowCount;e++)e<=1?(o.getRow(e).getCell(d).fill=r,o.getRow(e).getCell(d).font=s):4===d&&o.getRow(e).getCell(d).value>0?o.getRow(e).getCell(d).font=i:o.getRow(e).getCell(d).font=n,o.getRow(e).getCell(d).border=c,e>1&&e<=o.rowCount-10&&(o.getRow(e).hidden=!0)}},E=async()=>{try{const e=new b.exports.Workbook;await T(e,w.value[0],y.value,v.value),await T(e,w.value[1],x.value,m.value),await T(e,w.value[2],C.value,_.value);const t=await e.xlsx.writeBuffer();return k.success(f("Export successfully")),A(new Blob([t]),d.value+".xlsx")}catch(e){console.error(e),k.error(f("Failed to export"))}};return(e,t)=>{const a=s("el-button"),l=s("el-tooltip");return n(),i("span",O,[p("strong",D,g(`${r(f)("Export")}:`),1),u(l,{content:r(f)("Export as xlsx file"),effect:"dark",placement:"bottom"},{default:c((()=>[u(a,{icon:r(q),color:"#c6c6c6",circle:"",onClick:E},null,8,["icon"])])),_:1},8,["content"])])}}},[["__file","C:/Program Files/Workspace/it-req-fe/src/views/page-views/components/ExportXlsx.vue"]]),$={class:"mb-5"},V={class:"ce-main-container"},z={class:"ce-toolbar"},S={class:"mr-4"},M=e({__name:"index",setup(e){const a=t("Daily views report"),l=t("daily"),o=t([]),s=t([]),d=t(!1),w=t(!1),m=async e=>{const t=[];for await(const a of e){const{number:e,total:l}=a,o=a.date.substring(0,4),s=a.date.substring(5);t.push({number:e,year:o,date:s,total:l})}return t},h=async e=>{const t=e.map((e=>e.week)).filter(((e,t,a)=>a.indexOf(e)===t)),a=[];let l=0;for await(const o of t){let t=0;for await(const a of e)a.week===o&&(t+=a.total);a.push({number:++l,year:o.substring(0,4),week:o.substring(4),total:t})}return a},b=async e=>{const t=e.map((e=>e.date.substring(0,7))).filter(((e,t,a)=>a.indexOf(e)===t)),a=[];let l=0;for await(const o of t){let t=0;for await(const a of e)a.date.substring(0,7)===o&&(t+=a.total);a.push({number:++l,year:o.substring(0,4),month:o.substring(5),total:t})}return a},q=async e=>{if(e.length<=20)return e;{const t=[];for await(const[a,l]of Object.entries(e)){Number.parseInt(a)+1>e.length-20&&t.push(l)}return t}};x((async()=>{w.value=!0;try{const e=await _();o.value=Object.assign([],e.data),s.value=await m(o.value),setTimeout((()=>w.value=!1),1e3)}catch(e){console.error(e),k.error(f("Failed to get page views data"))}}));const A=async e=>{switch(l.value=e,w.value=!0,l.value){case"daily":s.value=await m(o.value),a.value="Daily views report";break;case"weekly":s.value=await h(o.value),a.value="Weekly views report";break;case"monthly":s.value=await b(o.value),a.value="Monthly views report";break;case"annual":a.value="Annual views report"}setTimeout((()=>w.value=!1),1e3)},E=e=>{w.value=!0,setInterval((()=>w.value=!1),2e3),d.value=e};return(e,t)=>(n(),i("div",$,[v(" title "),u(r(F),null,{title:c((()=>[C(g(r(f)(r(a))),1)])),_:1}),p("div",V,[v(" toolbar "),p("div",z,[u(r(j),{selected:r(l),onGetChildren:A},null,8,["selected"]),p("span",null,[p("span",S,[u(r(T),{"is-all":r(d),loading:r(w),onGetIsAll:E},null,8,["is-all","loading"])]),u(r(I),{daily:m(r(o)),weekly:h(r(o)),monthly:b(r(o))},null,8,["daily","weekly","monthly"])])]),v(" contents "),r(s).length?(n(),y(r(R),{key:0,data:r(d)?r(s):q(r(s)),"load-all":r(d),selected:r(l),loading:r(w)},null,8,["data","load-all","selected","loading"])):v("v-if",!0)])]))}},[["__file","C:/Program Files/Workspace/it-req-fe/src/views/page-views/index.vue"]]);export{M as default};
